<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="949.27">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #6e3d20}
p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #606060}
p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #5f4125}
p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #952e14}
p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #a8220e}
span.s1 {font: 18.0px Helvetica}
span.s2 {color: #000000}
span.s3 {color: #0b2aab}
span.s4 {color: #5f4125}
span.s5 {color: #1530a3}
span.s6 {color: #5f642f}
span.s7 {color: #001bb7}
span.s8 {color: #606060}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><span class="s1"><b>PartialTrackerFile<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b></span><b>FFT information into Array</b></p>
<p class="p2">by Federico Reuben</p>
<p class="p3"><br></p>
<p class="p2"><b>Superclass: PartialTracker</b></p>
<p class="p3"><br></p>
<p class="p2"><b>PartialTrackerFile( path, numberchannels, soundbuffer, windowSize,<span class="Apple-converted-space">  </span>numberPartials,<span class="Apple-converted-space">  </span>fftbuffer, magbuffer,<span class="Apple-converted-space">  </span>freqbuffer)</b></p>
<p class="p3"><br></p>
<p class="p2">Uses Josh's PV_MagBuffer and PV_FreqBuffer to get FFT information of a soundfile into an Array. You can specify the amount of partials you want from maximum to minimum.</p>
<p class="p3"><br></p>
<p class="p2">an example:</p>
<p class="p4"><br></p>
<p class="p5">s.boot;</p>
<p class="p6">//for stereo sound files</p>
<p class="p7"><span class="s2">p = </span><span class="s3">PartialTrackerFile</span><span class="s2">(</span>"/Users/freuben/Music/FReuben/Esferica/freuben-esferica_cantandote-2005.aif"<span class="s2">, 2);<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s2">p.startsynthbuf; </span>//use for stereo input</p>
<p class="p5">p.getarrays;</p>
<p class="p8"><span class="s2">p.frequencies; </span>//get array with frequencies</p>
<p class="p8"><span class="s2">p.magnitudes; </span>//get array with magnitudes</p>
<p class="p8"><span class="s2">p.numpartials(80); </span>//change number of partials</p>
<p class="p5">p.list</p>
<p class="p4"><br></p>
<p class="p5">p.numpartials(12)</p>
<p class="p5">p.frequencies.cpsmidi.round(1).midinote <span class="s4">//note names</span></p>
<p class="p4"><br></p>
<p class="p5">p.soundbuf</p>
<p class="p5">p.stoptask</p>
<p class="p4"><br></p>
<p class="p8">//for mono sound files</p>
<p class="p7"><span class="s2">m = </span><span class="s5">PartialTrackerFile</span><span class="s2">(</span>"/Users/federicoreuben/Music/FReuben/E-tudes/SoundingSamples/celesta/celesta.aif"<span class="s2">, 1);</span></p>
<p class="p5">m.startsynthbufmono;</p>
<p class="p5">m.getarrays;</p>
<p class="p5">m.frequencies;</p>
<p class="p5">m.magnitudes;</p>
<p class="p5">m.list</p>
<p class="p4"><br></p>
<p class="p8">//with Pbind</p>
<p class="p5">(</p>
<p class="p5"><span class="s5">SynthDef</span>(<span class="s6">\cfstring1</span>, { <span class="s5">arg</span> i_out, freq = 360, gate = 1, pan, amp=0.1;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s5">var</span> out, eg, fc, osc, a, b, w;</p>
<p class="p5"><span class="Apple-tab-span">	</span>fc = <span class="s5">LinExp</span>.kr(<span class="s5">LFNoise1</span>.kr(<span class="s5">Rand</span>(0.25,0.4)), -1,1,500,2000);</p>
<p class="p5"><span class="Apple-tab-span">	</span>osc = <span class="s5">Mix</span>.fill(8, {<span class="s5">LFSaw</span>.ar(freq * [<span class="s5">Rand</span>(0.99,1.01),<span class="s5">Rand</span>(0.99,1.01)], 0, amp) }).distort * 0.2;</p>
<p class="p5"><span class="Apple-tab-span">	</span>eg = <span class="s5">EnvGen</span>.kr(<span class="s5">Env</span>.asr(1,1,1), gate, doneAction:2);</p>
<p class="p5"><span class="Apple-tab-span">	</span>out = eg * <span class="s5">RLPF</span>.ar(osc, fc, 0.1);</p>
<p class="p5"><span class="Apple-tab-span">	</span>#a, b = out;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s5">Out</span>.ar(i_out, <span class="s5">Mix</span>.ar(<span class="s5">PanAz</span>.ar(4, [a, b], [pan, pan+0.3])));</p>
<p class="p5">}).store;</p>
<p class="p5">)</p>
<p class="p4"><br></p>
<p class="p5">r = <span class="s5">Routine</span>({<span class="s5">inf</span>.do({</p>
<p class="p5">t = <span class="s5">Pbind</span>(<span class="s6">\freq</span>, m.frequencies, <span class="s6">\amp</span>, m.magnitudes/150, <span class="s6">\dur</span>, rrand(0.1, 1.0),<span class="s6">\instrument</span>, <span class="s6">\cfstring1</span>);</p>
<p class="p5">1.do(t.next.play);</p>
<p class="p5">m.numpartials(rrand(1,6));</p>
<p class="p5">rrand(0.2,1.0).yield;</p>
<p class="p5">});</p>
<p class="p5">}).play</p>
<p class="p4"><br></p>
<p class="p5">r.stop;</p>
<p class="p4"><br></p>
<p class="p5">m.stoptask;</p>
<p class="p5">m.stop;</p>
<p class="p4"><br></p>
<p class="p9">/////////////////////////////////////////////////////////////////////</p>
<p class="p4"><br></p>
<p class="p9">//store information in an array:</p>
<p class="p5">s.boot;</p>
<p class="p4"><br></p>
<p class="p5">CocoaDialog.postln</p>
<p class="p4"><br></p>
<p class="p5">p = <span class="s7">PartialTrackerFile</span>(<span class="s8">"</span>/Users/freuben/Music/Aleks/3 Audio Track.aiff<span class="s8">"</span>, 2);<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p5">p.buffForData;</p>
<p class="p5">p.numpartials(10);</p>
<p class="p5">p.thresh(1)</p>
<p class="p4"><br></p>
<p class="p5">p.startSavingDataBuf2(0.001);</p>
<p class="p4"><br></p>
<p class="p5">p.stopSavingData;</p>
<p class="p4"><br></p>
<p class="p5">p.dataArray.dopost</p>
<p class="p4"><br></p>
<p class="p10">//save it to a midi file:</p>
<p class="p4"><br></p>
<p class="p7"><span class="s2">p.makeMidiFile(</span>"~/Desktop/spectralchords.mid"<span class="s2">, 120, </span>"4/4"<span class="s2">, 2);</span></p>
<p class="p4"><br></p>
</body>
</html>
